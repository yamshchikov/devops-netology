# Homework 10.6

## Краткое описание инцидента

В результате регламентных работ на сетевом оборудовании, основной сервер был недосутпен около 40 секунд. Вследствие этого, развалился кластер баз данных. Часть сервисов была недоступна на протяжении 24 часов.

## Предшествующие события

21 Октября в 22:52 проводились регламентные работы на сетевом оборудовании.

## Причина инцидента

Была потеряна связь между US East Coast network hub и US East Coast data center на 43 секунды.

## Воздействие

Не работили вебхуки и GitHub Pages

## Обнаружение

Проблема была обнаружена системой мониторинга в 22:54

## Реакция

Дежурные инженеры начали заниматься проблемой незамедлительно. В 23:09 проблема была передана координатору инцидентов, который включился в работу в 23:11 и поставил красный статус.

## Восстановление

Кластер БД был полностью восстановлен из бэкапа.

## Таймлайн

2018 October 21 22:52 UTC - во время регламетных работ случилось разделение сети. Орекстратор БД начал перенос ведущего узла в US West Coast data center.  
2018 October 21 22:54 UTC - система начала слать алерты. Дежурные инженеры определили, что топология БД находится в непредвиденном состоянии.  
2018 October 21 23:07 UTC - проблема была эскалирована менеджеру инцидентов.  
2018 October 21 23:19 UTC - были отключены вебхуки и GitHub Pages.  
2018 October 22 00:05 UTC - разработан план восстановления БД из бэкапа.  
2018 October 22 00:41 UTC - начат процесс восстановления. Инженеры мониторят процесс, ищут пути ускорения.  
2018 October 22 06:51 UTC - часть реплик восстановлена. Страницы начали открываться быстрее, если запрос падал на эти реплики. Рарзаботан план более быстрого восстановления оставшихся реплик.  
2018 October 22 07:46 UTC - опубликован блог с подробной информацией о проблеме.  
2018 October 22 11:12 UTC - основные ноды восстановлены. Всё ещё остается много отстающих реплик, из-за которых пользователи получают несогласованные данные.  
2018 October 22 16:24 UTC - все реплики восстановились и синхронизировались. Произведен возврат к изначальной топологии. Запущена обработка накопившейся очереди данных.  
2018 October 22 16:45 UTC - балансировка нагрузки, получаемой от накопившихся задач. Процесс восстановления продолжается.  
2018 October 22 23:03 UTC - все вебхуки и GitHub Pages обработаны. Система восстановлена, статус изменен на зеленый.  

## Последующие действия

Настроить оркестратор так, чтобы он больше не переносил главную ноду между датацентрами.

Пересмотреть систему оповещения - зеленый/желтый/красный статусы не информативны.

Добавить избычточности. Система должна должна оставаться полностью доступной при сбое одного датацентра.

Пересмотреть систему оценки ожидаемого времени восстановления.

Проработать возможные сценарии отказов.
